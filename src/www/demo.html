<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBPF File Server Demonstration</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #181818;
        }
        .kernel-badge {
            background: #28a745;
            color: rgb(32, 32, 32);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        .user-badge {
            background: #dc3545;
            color: rgb(32, 32, 32);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        .performance-test {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .test-button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .kernel-test {
            background: #28a745;
            color: white;
        }
        .user-test {
            background: #dc3545;
            color: white;
        }
        .results {
            margin-top: 10px;
            padding: 10px;
            background: rgb(32, 32, 32);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ eBPF File Server Demonstration</h1>
        
        <div class="demo-section">
            <h2>üîß System Architecture</h2>
            <p>This file server uses <strong>eBPF (Extended Berkeley Packet Filter)</strong> to process HTTP requests 
            directly in kernel space, providing significant performance improvements for static content delivery.</p>
            
            <h3>Processing Paths:</h3>
            <ul>
                <li><span class="kernel-badge">KERNEL SPACE</span> Simple GET requests for static files (index.html, static.html, etc.)</li>
                <li><span class="user-badge">USER SPACE</span> Complex requests, dynamic content, and file operations</li>
            </ul>
        </div>

        <div class="demo-section">
            <h2>üìä Performance Comparison</h2>
            <p>Click the buttons below to test response times for different processing paths:</p>
            
            <div class="performance-test">
                <div>
                    <h4>Kernel-Space Processing</h4>
                    <button class="test-button kernel-test" onclick="testKernelPath()">
                        Test index.html (Kernel Cache)
                    </button>
                    <div id="kernel-results" class="results">Click to test...</div>
                </div>
                
                <div>
                    <h4>User-Space Processing</h4>
                    <button class="test-button user-test" onclick="testUserPath()">
                        Test complex.html (User Space)
                    </button>
                    <div id="user-results" class="results">Click to test...</div>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üîç Technical Details</h2>
            <h3>eBPF Components:</h3>
            <ul>
                <li><strong>TC Ingress Program:</strong> Intercepts incoming HTTP packets on network interface</li>
                <li><strong>File Cache Map:</strong> Stores frequently accessed files in kernel memory</li>
                <li><strong>Statistics Map:</strong> Tracks performance metrics (kernel vs user processing)</li>
                <li><strong>Connection Tracking:</strong> Monitors client connections and request patterns</li>
            </ul>
            
            <h3>Benefits:</h3>
            <ul>
                <li>‚ö° <strong>Reduced Latency:</strong> Eliminate kernel-user space context switches</li>
                <li>üöÄ <strong>Higher Throughput:</strong> Process simple requests directly in kernel</li>
                <li>üíæ <strong>Memory Efficiency:</strong> Shared kernel cache for multiple processes</li>
                <li>üìà <strong>Scalability:</strong> Lower CPU overhead for static content</li>
            </ul>
        </div>

        <div class="demo-section">
            <h2>üìà Real-time Statistics</h2>
            <p>Monitor the server terminal to see:</p>
            <ul>
                <li>File caching messages: "Cached file 'filename' in kernel"</li>
                <li>Request processing paths (kernel vs user space)</li>
                <li>Performance metrics and statistics</li>
            </ul>
            <p><em>Run the fileserver_stats.py script for detailed real-time monitoring.</em></p>
        </div>

        <div class="demo-section">
            <h2>üîó Test Links</h2>
            <ul>
                <li><a href="/">Main Page (index.html)</a> - <span class="kernel-badge">Kernel Cached</span></li>
                <li><a href="/static.html">Static Test Page</a> - <span class="kernel-badge">Kernel Cached</span></li>
                <li><a href="/demo.html">This Demo Page</a> - <span class="user-badge">User Space</span></li>
                <li><a href="/nonexistent.html">404 Test</a> - <span class="user-badge">User Space</span></li>
            </ul>
        </div>
    </div>

    <script>
        async function testKernelPath() {
            const resultsDiv = document.getElementById('kernel-results');
            resultsDiv.innerHTML = 'Testing...';
            
            const startTime = performance.now();
            try {
                const response = await fetch('/');
                const endTime = performance.now();
                const responseTime = (endTime - startTime).toFixed(2);
                
                resultsDiv.innerHTML = `
                    ‚úÖ Response Time: ${responseTime}ms<br>
                    Status: ${response.status}<br>
                    Processing: <span class="kernel-badge">KERNEL SPACE</span>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        async function testUserPath() {
            const resultsDiv = document.getElementById('user-results');
            resultsDiv.innerHTML = 'Testing...';
            
            const startTime = performance.now();
            try {
                const response = await fetch('/nonexistent.html');
                const endTime = performance.now();
                const responseTime = (endTime - startTime).toFixed(2);
                
                resultsDiv.innerHTML = `
                    ‚úÖ Response Time: ${responseTime}ms<br>
                    Status: ${response.status}<br>
                    Processing: <span class="user-badge">USER SPACE</span>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }

        // Auto-refresh demonstration
        setInterval(() => {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`eBPF File Server Demo - ${timestamp}`);
        }, 5000);
    </script>
</body>
</html>
